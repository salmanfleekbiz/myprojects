function UGThumbsGrid(){var t=this,g_objThis=jQuery(this);var g_gallery=new UniteGalleryMain(),g_objGallery,g_objects,g_objWrapper;var g_functions=new UGFunctions(),g_arrItems,g_objGrid,g_objInner;var g_thumbs=new UGThumbsGeneral(),g_tilesDesign=new UGTileDesign();var g_options={grid_panes_direction:"left",grid_num_cols:2,grid_num_rows:2,grid_space_between_cols:10,grid_space_between_rows:10,grid_transition_duration:300,grid_transition_easing:"easeInOutQuad",grid_carousel:false,grid_padding:0,grid_vertical_scroll_ondrag:false};this.events={PANE_CHANGE:"pane_change"};var g_temp={eventSizeChange:"thumb_size_change",isHorizontal:false,isMaxHeight:false,isMaxWidth:false,gridHeight:0,gridWidth:0,innerWidth:0,innerHeight:0,numPanes:0,arrPanes:0,numThumbs:0,currentPane:0,numThumbsInPane:0,isNavigationVertical:false,touchActive:false,startScrollPos:0,isFirstTimeRun:true,isTilesMode:false,storedEventID:"thumbsgrid"};function __________GENERAL_________(){};function init(gallery,customOptions,isTilesMode){g_objects=gallery.getObjects();g_gallery=gallery;g_gallery.attachThumbsPanel("grid",t);g_objGallery=jQuery(gallery);g_objWrapper=g_objects.g_objWrapper;g_arrItems=g_objects.g_arrItems;if(isTilesMode===true)g_temp.isTilesMode=true;g_temp.numThumbs=g_arrItems.length;setOptions(customOptions);g_temp.isNavigationVertical=(g_options.grid_panes_direction=="top"||g_options.grid_panes_direction=="bottom")
if(g_temp.isTilesMode==true){g_tilesDesign.setFixedMode();g_tilesDesign.setApproveClickFunction(isApproveTileClick);g_tilesDesign.init(gallery,g_options);g_thumbs=g_tilesDesign.getObjThumbs();}else{customOptions.thumb_fixed_size=true;g_thumbs.init(gallery,customOptions);}}function setHtml(parentContainer){var objParent=g_objWrapper;if(parentContainer)objParent=parentContainer;objParent.append("<div class='ug-thumbs-grid'><div class='ug-thumbs-grid-inner'></div></div>");g_objGrid=objParent.children(".ug-thumbs-grid");g_objInner=g_objGrid.children(".ug-thumbs-grid-inner");if(g_temp.isTilesMode==true)g_tilesDesign.setHtml(g_objInner);else
g_thumbs.setHtmlThumbs(g_objInner);}function validateBeforeRun(){if(g_temp.isHorizontal==false){if(g_temp.gridHeight==0)throw new Error("You must set height before run.");}else{if(g_temp.gridWidth==0)throw new Error("You must set width before run.");}}function run(){var selectedItem=g_gallery.getSelectedItem();validateBeforeRun();if(g_temp.isFirstTimeRun==true){if(g_temp.isTilesMode==true){initSizeParams();g_tilesDesign.run();}else{g_thumbs.setHtmlProperties();initSizeParams();g_thumbs.loadThumbsImages();}initEvents();}positionThumbs();if(g_temp.isFirstTimeRun==true&&g_temp.isTilesMode){var objTiles=g_thumbs.getThumbs();objTiles.each(function(index,tile){g_objWrapper.trigger(g_temp.eventSizeChange,jQuery(tile));});objTiles.fadeTo(0,1);}if(selectedItem!=null)scrollToThumb(selectedItem.index);g_objThis.trigger(t.events.PANE_CHANGE,g_temp.currentPane);g_temp.isFirstTimeRun=false;}function initSizeParamsHor(){var arrThumbs=g_objInner.children(".ug-thumb-wrapper");var firstThumb=jQuery(arrThumbs[0]);var thumbsRealHeight=firstThumb.outerHeight();var gridWidth=g_temp.gridWidth;var gridHeight=g_options.grid_num_rows*thumbsRealHeight+(g_options.grid_num_rows-1)*g_options.grid_space_between_rows+g_options.grid_padding*2;g_temp.gridHeight=gridHeight;g_functions.setElementSize(g_objGrid,gridWidth,gridHeight);g_functions.setElementSize(g_objInner,gridWidth,gridHeight);g_temp.innerWidth=gridWidth;g_temp.innerHeight=gridHeight;}function initSizeParamsVert(){var arrThumbs=g_objInner.children(".ug-thumb-wrapper");var firstThumb=jQuery(arrThumbs[0]);var thumbsRealWidth=firstThumb.outerWidth();var gridWidth=g_options.grid_num_cols*thumbsRealWidth+(g_options.grid_num_cols-1)*g_options.grid_space_between_cols+g_options.grid_padding*2;var gridHeight=g_temp.gridHeight;g_temp.gridWidth=gridWidth;g_functions.setElementSize(g_objGrid,gridWidth,gridHeight);g_functions.setElementSize(g_objInner,gridWidth,gridHeight);g_temp.innerWidth=gridWidth;g_temp.innerHeight=gridHeight;}function initSizeParams(){if(g_temp.isHorizontal==false)initSizeParamsVert();else
initSizeParamsHor();}function scrollToThumb(thumbIndex){var paneIndex=getPaneIndexByThumbIndex(thumbIndex);if(paneIndex==-1)return(false);t.gotoPane(paneIndex,"scroll");}function setOptions(objOptions){g_options=jQuery.extend(g_options,objOptions);g_thumbs.setOptions(objOptions);}function positionThumb_hor(){var arrThumbs=g_objInner.children(".ug-thumb-wrapper");var posx=0;var posy=0;var counter=0;var baseX=0;var maxx=0,maxy=0;g_temp.innerWidth=0;g_temp.numPanes=1;g_temp.arrPanes=[];g_temp.numThumbsInPane=0;g_temp.arrPanes.push(baseX);var numThumbs=arrThumbs.length;for(i=0;i<numThumbs;i++){var objThumb=jQuery(arrThumbs[i]);g_functions.placeElement(objThumb,posx,posy);var thumbWidth=objThumb.outerWidth();var thumbHeight=objThumb.outerHeight();if(posx>maxx)maxx=posx;var endY=posy+thumbHeight;if(endY>maxy)maxy=endY;var endX=maxx+thumbWidth;if(endX>g_temp.innerWidth)g_temp.innerWidth=endX;posx+=thumbWidth+g_options.grid_space_between_cols;counter++;if(counter>=g_options.grid_num_cols){posy+=thumbHeight+g_options.grid_space_between_rows;posx=baseX;counter=0;}if(g_temp.numPanes==1)g_temp.numThumbsInPane++;if((posy+thumbHeight)>g_temp.gridHeight){posy=0;baseX=g_temp.innerWidth+g_options.grid_space_between_cols;posx=baseX;counter=0;if(g_temp.isMaxHeight==true&&g_temp.numPanes==1){g_temp.gridHeight=maxy;g_objGrid.height(g_temp.gridHeight);}if(i<(numThumbs-1)){g_temp.numPanes++;g_temp.arrPanes.push(baseX);}}}g_objInner.width(g_temp.innerWidth);if(g_temp.isMaxHeight==true&&g_temp.numPanes==1){g_temp.gridHeight=maxy;g_objGrid.height(maxy);}}function positionThumb_vert(){var arrThumbs=g_objInner.children(".ug-thumb-wrapper");var posx=0;var posy=0;var maxy=0;var counter=0;var baseX=0;var paneStartY=0;g_temp.innerWidth=0;g_temp.numPanes=1;g_temp.arrPanes=[];g_temp.numThumbsInPane=0;g_temp.arrPanes.push(baseX);var numThumbs=arrThumbs.length;for(i=0;i<numThumbs;i++){var objThumb=jQuery(arrThumbs[i]);g_functions.placeElement(objThumb,posx,posy);var thumbWidth=objThumb.outerWidth();var thumbHeight=objThumb.outerHeight();posx+=thumbWidth+g_options.grid_space_between_cols;var endy=(posy+thumbHeight);if(endy>maxy)maxy=endy;counter++;if(counter>=g_options.grid_num_cols){posy+=thumbHeight+g_options.grid_space_between_rows;posx=baseX;counter=0;}if(g_temp.numPanes==1)g_temp.numThumbsInPane++;endy=(posy+thumbHeight);var paneMaxY=paneStartY+g_temp.gridHeight;if(endy>paneMaxY){if(g_temp.isMaxHeight==true&&g_temp.numPanes==1){g_temp.gridHeight=maxy;g_objGrid.height(g_temp.gridHeight);paneMaxY=g_temp.gridHeight;}posy=paneMaxY+g_options.grid_space_between_rows;paneStartY=posy;baseX=0;posx=baseX;counter=0;if(i<(numThumbs-1)){g_temp.numPanes++;g_temp.arrPanes.push(posy);}}}g_objInner.height(maxy);g_temp.innerHeight=maxy;if(g_temp.isMaxHeight==true&&g_temp.numPanes==1){g_temp.gridHeight=maxy;g_objGrid.height(maxy);}}function positionThumb_hortype(){var arrThumbs=g_objInner.children(".ug-thumb-wrapper");var baseX=g_options.grid_padding;var baseY=g_options.grid_padding;var posy=baseY;var posx=baseX;var maxx=0,maxy=0,paneMaxY=0;var rowsCounter=0;g_temp.innerWidth=0;g_temp.numPanes=1;g_temp.arrPanes=[];g_temp.numThumbsInPane=0;g_temp.arrPanes.push(baseX-g_options.grid_padding);var numThumbs=arrThumbs.length;for(i=0;i<numThumbs;i++){var objThumb=jQuery(arrThumbs[i]);var thumbWidth=objThumb.outerWidth();var thumbHeight=objThumb.outerHeight();if((posx-baseX+thumbWidth)>g_temp.gridWidth){rowsCounter++;posy=0;if(rowsCounter>=g_options.grid_num_rows){rowsCounter=0;baseX=posx;paneMaxY=0;posy=baseY;if(g_temp.numPanes==1){g_temp.gridWidth=maxx+g_options.grid_padding;g_objGrid.width(g_temp.gridWidth);}g_temp.numPanes++;g_temp.arrPanes.push(baseX-g_options.grid_padding);}else{posx=baseX;posy=paneMaxY+g_options.grid_space_between_rows;}}g_functions.placeElement(objThumb,posx,posy);var endX=posx+thumbWidth;if(endX>maxx)maxx=endX;var endY=posy+thumbHeight;if(endY>paneMaxY)paneMaxY=endY;if(endY>maxy)maxy=endY;var endX=maxx+thumbWidth;if(endX>g_temp.innerWidth)g_temp.innerWidth=endX;posx+=thumbWidth+g_options.grid_space_between_cols;if(g_temp.numPanes==1)g_temp.numThumbsInPane++;}g_temp.innerWidth=maxx;g_temp.innerHeight=paneMaxY;g_objInner.width(g_temp.innerWidth);g_objInner.height(g_temp.innerHeight);if(g_temp.numPanes==1){g_temp.gridWidth=maxx+g_options.grid_padding;g_temp.gridHeight=maxy+g_options.grid_padding;g_objGrid.width(g_temp.gridWidth);g_objGrid.height(g_temp.gridHeight);}}function positionThumbs(){if(g_temp.isHorizontal==false){if(g_temp.isNavigationVertical)positionThumb_vert();else
positionThumb_hor();}else{positionThumb_hortype();}}function validateThumbIndex(thumbIndex){if(thumbIndex<0||thumbIndex>=g_temp.numThumbs){throw new Error("Thumb not exists: "+thumbIndex);return(false);}return(true);}function validatePaneIndex(paneIndex){if(paneIndex>=g_temp.numPanes||paneIndex<0){throw new Error("Pane "+index+" doesn't exists.");return(false);}return(true);}function validateInnerPos(pos){var absPos=Math.abs(pos);if(g_temp.isNavigationVertical==false){if(absPos<0||absPos>=g_temp.innerWidth){throw new Error("wrong inner x position: "+pos);return(false);}}else{if(absPos<0||absPos>=g_temp.innerHeight){throw new Error("wrong inner y position: "+pos);return(false);}}return(true);}function setInnerPos(pos){var objCss=getInnerPosObj(pos);if(objCss==false)return(false);g_objInner.css(objCss);}function animateInnerTo(pos){var objCss=getInnerPosObj(pos);if(objCss==false)return(false);g_objInner.stop(true).animate(objCss,{duration:g_options.grid_transition_duration,easing:g_options.grid_transition_easing,queue:false});}function animateToCurrentPane(){var innerPos=-g_temp.arrPanes[g_temp.currentPane];animateInnerTo(innerPos);}function __________GETTERS_________(){};function getInnerSize(){if(g_temp.isNavigationVertical==true)return(g_temp.innerHeight);else
return(g_temp.innerWidth);}function getPaneSize(){if(g_temp.isNavigationVertical==true)return(g_temp.gridHeight);else
return(g_temp.gridWidth);}function getInnerPosObj(pos){var obj={};if(g_temp.isNavigationVertical==true)obj.top=pos+"px";else
obj.left=pos+"px";return(obj);}function getMousePos(event){var mousePos=g_functions.getMousePosition(event);if(g_temp.isNavigationVertical==true)return(mousePos.pageY);else
return(mousePos.pageX);}function getInnerPos(){var objSize=g_functions.getElementSize(g_objInner);if(g_temp.isNavigationVertical==true)return(objSize.top);else
return(objSize.left);}function getPaneIndexByThumbIndex(thumbIndex){if(validateThumbIndex(thumbIndex)==false)return(-1);var numPane=Math.floor(thumbIndex/g_temp.numThumbsInPane);return(numPane);}function getPanePosition(index){var pos=g_temp.arrPanes[index];return(pos);}function isSignificantPassed(){if(g_temp.numPanes==1)return(false);var objData=g_functions.getStoredEventData(g_temp.storedEventID);var passedTime=objData.diffTime;var currentInnerPos=getInnerPos();var passedDistanceAbs=Math.abs(currentInnerPos-objData.startInnerPos);if(passedDistanceAbs>30)return(true);if(passedDistanceAbs>5&&passedTime>300)return(true);return(false);}function isMovementValidForChange(){var objData=g_functions.getStoredEventData(g_temp.storedEventID);var currentInnerPos=getInnerPos();diffPos=Math.abs(objData.startInnerPos-currentInnerPos);var paneSize=getPaneSize();var breakSize=Math.round(paneSize*3/8);if(diffPos>=breakSize)return(true);if(objData.diffTime<300&&diffPos>25)return(true);return(false);}function isApproveTileClick(){if(g_temp.numPanes==1)return(true);var isApprove=g_functions.isApproveStoredEventClick(g_temp.storedEventID,g_temp.isNavigationVertical);return(isApprove);}function __________EVENTS_______(){};function onThumbClick(event){if(isSignificantPassed()==true)return(true);var objThumb=jQuery(this);var objItem=g_thumbs.getItemByThumb(objThumb);g_gallery.selectItem(objItem);}function onTouchStart(event){if(g_temp.numPanes==1)return(true);if(g_temp.touchActive==true)return(true);if(g_temp.isTilesMode==false)event.preventDefault();g_temp.touchActive=true;var addData={startInnerPos:getInnerPos()};g_functions.storeEventData(event,g_temp.storedEventID,addData);}function handleScrollTop(){if(g_options.grid_vertical_scroll_ondrag==false)return(false);if(g_temp.isNavigationVertical==true)return(false);var scrollDir=g_functions.handleScrollTop(g_temp.storedEventID);if(scrollDir==="vert")return(true);return(false);}function onTouchMove(event){if(g_temp.touchActive==false)return(true);event.preventDefault();g_functions.updateStoredEventData(event,g_temp.storedEventID);var objData=g_functions.getStoredEventData(g_temp.storedEventID,g_temp.isNavigationVertical);var isScroll=handleScrollTop();if(isScroll)return(true);var diff=objData.diffMousePos;var innerPos=objData.startInnerPos+diff;var direction=(diff>0)?"prev":"next";var lastPaneSize=g_temp.arrPanes[g_temp.numPanes-1];if(g_options.grid_carousel==false&&innerPos>0&&direction=="prev"){innerPos=innerPos/3;}if(g_options.grid_carousel==false&&innerPos<-lastPaneSize&&direction=="next"){innerPos=objData.startInnerPos+diff/3;}setInnerPos(innerPos);}function onTouchEnd(event){if(g_temp.touchActive==false)return(true);g_functions.updateStoredEventData(event,g_temp.storedEventID);var objData=g_functions.getStoredEventData(g_temp.storedEventID,g_temp.isNavigationVertical);g_temp.touchActive=false;if(isMovementValidForChange()==false){animateToCurrentPane();return(true);}var innerPos=getInnerPos();var diff=innerPos-objData.startInnerPos;var direction=(diff>0)?"prev":"next";if(direction=="next"){if(g_options.grid_carousel==false&&t.isLastPane())animateToCurrentPane();else
t.nextPane();}else{if(g_options.grid_carousel==false&&t.isFirstPane()){animateToCurrentPane();}else
t.prevPane();}}function onItemChange(){var objItem=g_gallery.getSelectedItem();g_thumbs.setThumbSelected(objItem.objThumbWrapper);scrollToThumb(objItem.index);}function initEvents(){if(g_temp.isTilesMode==false){g_thumbs.initEvents();var objThumbs=g_objGrid.find(".ug-thumb-wrapper");objThumbs.on("click touchend",onThumbClick);g_objGallery.on(g_gallery.events.ITEM_CHANGE,onItemChange);}else{g_tilesDesign.initEvents();}g_objGrid.bind("mousedown touchstart",onTouchStart);jQuery("body").bind("mousemove touchmove",onTouchMove);jQuery(window).add("body").bind("mouseup touchend",onTouchEnd);}this.destroy=function(){if(g_temp.isTilesMode==false){var objThumbs=g_objGrid.find(".ug-thumb-wrapper");objThumbs.off("click");objThumbs.off("touchend");g_objGallery.on(g_gallery.events.ITEM_CHANGE);g_thumbs.destroy();}else{g_tilesDesign.destroy();}g_objGrid.unbind("mousedown");g_objGrid.unbind("touchstart");jQuery("body").unbind("mousemove");jQuery("body").unbind("touchmove");jQuery(window).add("body").unbind("touchend");jQuery(window).add("body").unbind("mouseup");g_objThis.off(t.events.PANE_CHANGE);}
this.__________EXTERNAL_GENERAL_________=function(){};this.setThumbUnselected=function(objThumbWrapper){g_thumbs.setThumbUnselected(objThumbWrapper);}
this.isItemThumbVisible=function(objItem){var itemIndex=objItem.index;var paneIndex=getPaneIndexByThumbIndex(itemIndex);if(paneIndex==g_temp.currentPane)return(true);return(false);}
this.__________EXTERNAL_API_________=function(){};this.getNumPanesEstimationByHeight=function(gridHeight){if(g_temp.isTilesMode==true){var thumbHeight=g_options.tile_height;}else{var thumbsOptions=g_thumbs.getOptions();var thumbHeight=thumbsOptions.thumb_height;}var numThumbs=g_thumbs.getNumThumbs();var numRows=Math.ceil(numThumbs/g_options.grid_num_cols);var totalHeight=numRows*thumbHeight+(numRows-1)*g_options.grid_space_between_rows;var numPanes=Math.ceil(totalHeight/gridHeight);return(numPanes);}
this.getNumPanesEstimationByWidth=function(gridWidth){if(g_temp.isTilesMode){var thumbWidth=g_options.tile_width;}else{var thumbsOptions=g_thumbs.getOptions();var thumbWidth=thumbsOptions.thumb_width;}var numThumbs=g_thumbs.getNumThumbs();var numCols=Math.ceil(numThumbs/g_options.grid_num_rows);var totalWidth=numCols*thumbWidth+(numCols-1)*g_options.grid_space_between_cols;var numPanes=Math.ceil(totalWidth/gridWidth);return(numPanes);}
this.getHeightEstimationByWidth=function(width){if(g_temp.isTilesMode==false)throw new Error("This function works only with tiles mode");var numThumbs=g_thumbs.getNumThumbs();var numCols=g_functions.getNumItemsInSpace(width,g_options.tile_width,g_options.grid_space_between_cols);var numRows=Math.ceil(numThumbs/numCols);if(numRows>g_options.grid_num_rows)numRows=g_options.grid_num_rows;var gridHeight=g_functions.getSpaceByNumItems(numRows,g_options.tile_height,g_options.grid_space_between_rows);gridHeight+=g_options.grid_padding*2;return(gridHeight);}
this.getElement=function(){return(g_objGrid);}
this.getSize=function(){var objSize=g_functions.getElementSize(g_objGrid);return(objSize);}
this.getNumPanes=function(){return(g_temp.numPanes);}
this.isFirstPane=function(){if(g_temp.currentPane==0)return(true);return(false);}
this.isLastPane=function(){if(g_temp.currentPane==(g_temp.numPanes-1))return(true);return(false);}
this.getPaneInfo=function(){var obj={pane:g_temp.currentPane,total:g_temp.numPanes};return(obj);}
this.getPane=function(){return(g_temp.currentPane);}
this.setWidth=function(gridWidth){g_temp.gridWidth=gridWidth;g_temp.isHorizontal=true;}
this.setMaxWidth=function(maxWidth){g_temp.gridWidth=maxWidth;g_temp.isMaxWidth=true;g_temp.isHorizontal=true;}
this.setHeight=function(gridHeight){g_temp.gridHeight=gridHeight;g_temp.isHorizontal=false;}
this.setMaxHeight=function(maxHeight){g_temp.gridHeight=maxHeight;g_temp.isMaxHeight=true;g_temp.isHorizontal=false;}
this.gotoPane=function(index,fromWhere){if(validatePaneIndex(index)==false)return(false);if(index==g_temp.currentPane)return(false);var innerPos=-g_temp.arrPanes[index];g_temp.currentPane=index;animateInnerTo(innerPos);g_objThis.trigger(t.events.PANE_CHANGE,index);}
this.nextPane=function(){var nextPaneIndex=g_temp.currentPane+1;if(nextPaneIndex>=g_temp.numPanes){if(g_options.grid_carousel==false)return(true);nextPaneIndex=0;}t.gotoPane(nextPaneIndex,"next");}
this.prevPane=function(){var prevPaneIndex=g_temp.currentPane-1;if(prevPaneIndex<0){prevPaneIndex=g_temp.numPanes-1;if(g_options.grid_carousel==false)return(false);}t.gotoPane(prevPaneIndex,"prev");}
this.attachNextPaneButton=function(objButton){g_functions.setButtonOnClick(objButton,t.nextPane);if(g_options.grid_carousel==true)return(true);if(t.isLastPane())objButton.addClass("ug-button-disabled");g_objThis.on(t.events.PANE_CHANGE,function(){if(t.isLastPane())objButton.addClass("ug-button-disabled");else
objButton.removeClass("ug-button-disabled");});}
this.attachPrevPaneButton=function(objButton){g_functions.setButtonOnClick(objButton,t.prevPane);if(g_options.grid_carousel==true)return(true);if(t.isFirstPane())objButton.addClass("ug-button-disabled");g_objThis.on(t.events.PANE_CHANGE,function(){if(t.isFirstPane())objButton.addClass("ug-button-disabled");else
objButton.removeClass("ug-button-disabled");});}
this.attachBullets=function(objBullets){objBullets.setActive(g_temp.currentPane);jQuery(objBullets).on(objBullets.events.BULLET_CLICK,function(data,numBullet){t.gotoPane(numBullet,"theme");objBullets.setActive(numBullet);});jQuery(t).on(t.events.PANE_CHANGE,function(data,numPane){objBullets.setActive(numPane);});}
this.getObjTileDesign=function(){return g_tilesDesign;}
this.init=function(gallery,customOptions,isTilesMode){init(gallery,customOptions,isTilesMode);}
this.run=function(){run();}
this.setHtml=function(parentContainer){setHtml(parentContainer);}}