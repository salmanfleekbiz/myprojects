function UGTouchThumbsControl(){var g_parent,g_gallery,g_objGallery,g_objects;var g_objStrip,g_objStripInner,g_options,g_isVertical;var g_functions=new UGFunctions();var g_serviceParams={touch_portion_time:200,thumb_touch_slowFactor:0,minDeltaTime:70,minPath:10,limitsBreakAddition:30,returnAnimateSpeed:500,animationEasing:"easeOutCubic",returnAnimationEasing:"easeOutCubic"};var g_temp={touch_active:false,loop_active:false,mousePos:0,innerPos:0,startPos:0,startTime:0,lastTime:0,buttonReleaseTime:0,lastPos:0,lastPortionPos:0,lastDeltaTime:0,lastDeltaPos:0,speed:0,handle:"",touchEnabled:false,isControlEnabled:true};this.enable=function(){g_temp.isControlEnabled=true;}
this.disable=function(){g_temp.isControlEnabled=false;}
this.init=function(objStrip){g_parent=objStrip;g_objects=objStrip.getObjects();g_gallery=g_objects.g_gallery;g_objGallery=g_objects.g_objGallery;g_objStrip=g_objects.g_objStrip;g_objStripInner=g_objects.g_objStripInner;g_options=g_objects.g_options;g_isVertical=g_objects.isVertical;setServiceParams();initEvents();}
function getActionVars(){var currentTime=jQuery.now();var obj={};obj.passedTime=g_temp.lastTime-g_temp.startTime;obj.lastActiveTime=currentTime-g_temp.buttonReleaseTime;obj.passedDistance=g_temp.lastPos-g_temp.startPos;obj.passedDistanceAbs=Math.abs(obj.passedDistance);return(obj);}this.isSignificantPassed=function(){var objVars=getActionVars();if(objVars.passedTime>300)return(true);if(objVars.passedDistanceAbs>30)return(true);return(false);}
this.isTouchActive=function(){if(g_temp.touch_active==true)return(true);if(g_objStripInner.is(":animated")==true)return(true);var objVars=getActionVars();if(objVars.lastActiveTime<50)return(true);return(false);}
function setServiceParams(){g_serviceParams.thumb_touch_slowFactor=g_functions.normalizeSetting(0.00005,0.01,1,100,g_options.strip_thumb_touch_sensetivity,true);}function getMouseOrientPosition(event){if(g_isVertical==false)return(g_functions.getMousePosition(event).pageX);else
return(g_functions.getMousePosition(event).pageY);}function handleStripDrag(mousePos){var diff=g_temp.mousePos-mousePos;var distPos=g_temp.innerPos-diff;var objLimits=g_parent.getInnerStripLimits();if(distPos>objLimits.maxPos){var path=distPos-objLimits.maxPos;distPos=objLimits.maxPos+path/3;}if(distPos<objLimits.minPos){var path=objLimits.minPos-distPos;distPos=objLimits.minPos-path/3;}g_parent.positionInnerStrip(distPos);}function storeInitTouchValues(pagePos){var currentInnerPos=g_parent.getInnerStripPos();g_temp.mousePos=pagePos;g_temp.innerPos=currentInnerPos;g_temp.lastPortionPos=currentInnerPos;g_temp.lastDeltaTime=0;g_temp.lastDeltaPos=0;g_temp.startTime=jQuery.now();g_temp.startPos=g_temp.innerPos;g_temp.lastTime=g_temp.startTime;g_temp.lastPos=g_temp.startPos;g_temp.speed=0;}function storeTouchPortionData(){var currentTime=jQuery.now();var deltaTime=currentTime-g_temp.lastTime;if(deltaTime>=g_serviceParams.touch_portion_time){g_temp.lastDeltaTime=currentTime-g_temp.lastTime;if(g_temp.lastDeltaTime>g_serviceParams.touch_portion_time)g_temp.lastDeltaTime=g_serviceParams.touch_portion_time;g_temp.lastDeltaPos=g_temp.lastPos-g_temp.lastPortionPos;g_temp.lastPortionPos=g_temp.lastPos;g_temp.lastTime=currentTime;}}function continueTouchMotion(){var slowFactor=g_serviceParams.thumb_touch_slowFactor;var minDeltaTime=g_serviceParams.minDeltaTime;var minPath=g_serviceParams.minPath;var currentInnerPos=g_parent.getInnerStripPos();var currentTime=jQuery.now();var deltaTime=currentTime-g_temp.lastTime;var deltaPos=currentInnerPos-g_temp.lastPortionPos;if(deltaTime<minDeltaTime&&g_temp.lastDeltaTime>0){deltaTime=g_temp.lastDeltaTime;deltaPos=g_temp.lastDeltaPos+deltaPos;}if(deltaTime<minDeltaTime)deltaTime=minDeltaTime;var dir=(deltaPos>0)?1:-1;var speed=0;if(deltaTime>0)speed=deltaPos/deltaTime;var path=(speed*speed)/(slowFactor*2)*dir;if(Math.abs(path)<=minPath)path=0;var innerStripPos=g_parent.getInnerStripPos();var newPos=innerStripPos+path;var correctPos=g_parent.fixInnerStripLimits(newPos);var objLimits=g_parent.getInnerStripLimits();var limitsBreakAddition=g_serviceParams.limitsBreakAddition;var doQueue=false;var returnPos=correctPos;if(newPos>objLimits.maxPos){doQueue=true;correctPos=limitsBreakAddition;if(newPos<limitsBreakAddition)correctPos=newPos;}if(newPos<objLimits.minPos){doQueue=true;var maxStopPos=objLimits.minPos-limitsBreakAddition;correctPos=maxStopPos;if(newPos>maxStopPos)correctPos=newPos;}var correctPath=correctPos-innerStripPos;var animateSpeed=Math.abs(Math.round(speed/slowFactor));if(path!=0)animateSpeed=animateSpeed*correctPath/path;if(innerStripPos!=correctPos){var animateProps={"left":correctPos+"px"};if(g_isVertical==true)animateProps={"top":correctPos+"px"};g_objStripInner.animate(animateProps,{duration:animateSpeed,easing:g_serviceParams.animationEasing,queue:true,progress:onAnimateProgress});}if(doQueue==true){var returnAnimateSpeed=g_serviceParams.returnAnimateSpeed;var returnAnimateProps={"left":returnPos+"px"};if(g_isVertical==true)returnAnimateProps={"top":returnPos+"px"};g_objStripInner.animate(returnAnimateProps,{duration:returnAnimateSpeed,easing:g_serviceParams.returnAnimationEasing,queue:true,progress:onAnimateProgress});}}function onAnimateProgress(){g_temp.lastPos=g_parent.getInnerStripPos();g_parent.triggerStripMoveEvent();}function startStripTouchLoop(){if(g_temp.loop_active==true)return(true);g_temp.loop_active=true;g_temp.handle=setInterval(storeTouchPortionData,10);}function endStripTouchLoop(event){if(g_temp.loop_active==false)return(true);if(event){var pagePos=getMouseOrientPosition(event);continueTouchMotion(pagePos);}g_temp.loop_active=false;g_temp.handle=clearInterval(g_temp.handle);}function onTouchEnd(event){if(g_temp.isControlEnabled==false)return(true);g_temp.buttonReleaseTime=jQuery.now();if(g_temp.touch_active==false){endStripTouchLoop(event);return(true);}event.preventDefault();g_temp.touch_active=false;endStripTouchLoop(event);g_objStrip.removeClass("ug-dragging");}function onTouchStart(event){if(g_temp.isControlEnabled==false)return(true);event.preventDefault();g_temp.touch_active=true;var pagePos=getMouseOrientPosition(event);g_objStripInner.stop(true);storeInitTouchValues(pagePos);startStripTouchLoop();g_objStrip.addClass("ug-dragging");}function onTouchMove(event){if(g_temp.isControlEnabled==false)return(true);if(g_temp.touch_active==false)return(true);event.preventDefault();if(event.buttons==0){g_temp.touch_active=false;endStripTouchLoop(event);return(true);}var pagePos=getMouseOrientPosition(event);g_temp.lastPos=g_parent.getInnerStripPos();handleStripDrag(pagePos);storeTouchPortionData();}function initEvents(){g_objStrip.bind("mousedown touchstart",onTouchStart);jQuery(window).add("body").bind("mouseup touchend",onTouchEnd);jQuery("body").bind("mousemove touchmove",onTouchMove);}this.destroy=function(){g_objStrip.unbind("mousedown");g_objStrip.unbind("touchstart");jQuery(window).add("body").unbind("mouseup").unbind("touchend");jQuery("body").unbind("mousemove").unbind("touchmove");}}